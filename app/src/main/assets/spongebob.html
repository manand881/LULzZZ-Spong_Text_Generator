<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <title>Mocking Spongebob Squarepants Text Generator</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.18.1/build/cssreset-context/cssreset-context-min.css">
    <style type="text/css">

        textarea {
            display:block;
            width:400px;
            height:10em;
            margin:1em
        }
}
        #dl-btn {
            display:block;
            margin:1em 0px
        }

        #rows > * {
            margin-right:20px
        }

    </style>

    <link href="https://fonts.googleapis.com/css?family=Anton&amp;subset=latin" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&display=swap" rel="stylesheet">

</head>
<body>

<div class="container">
    <div class="row">
        <div class="col">
            <img class="img-responsive" src="meme.jpg">
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col">
            <h3>Download/share your image</h3>
            <a href="#" download="stoP-THAt-RiGHT-nOW.jpg" id="dl-btn">
                Download / Share Image
            </a>
            <div class="yui3-cssreset">
                <canvas id="canvas"></canvas>
            </div>
        </div>
    </div>
</div>

<script language="javascript">

    var dummy=" ";

    function readTextFile(file)
    {
        var allText;
        var rawFile = new XMLHttpRequest();
        rawFile.open("GET", file, false);
        rawFile.onreadystatechange = function ()
        {
            if(rawFile.readyState === 4)
            {
                if(rawFile.status === 200 || rawFile.status === 0)
                {
                    allText = rawFile.responseText;
                    dummy=allText;
                }
            }
        };
        rawFile.send(null);

    }

    readTextFile("input.txt");

    var img = new Image();
    // var width = 583;
    var width = window.innerWidth;
    var height = 411;
    var center = width / 2;
    var lineWidth = 2.5;
    var fontSize = 42;

    function mock () {
        ctx.drawImage(img, 0, 0);
        ctx.font = fontSize + "px Roboto Condensed";
        ctx.lineWidth = lineWidth;

        // text = output.value = text.split("").map(tweak).join("");
        var text = dummy;
        var m = text.match(/([^\n]+(?:\n[^\n]+)*)?(\n(?:\n[^\n]+)*)?/);
        var top = m[1] ? m[1] : "";
        var bottom = m[2] ? m[2] : "";

        top.split("\n").map(function (line, lineno) {
            // top margin + number of lines * char height incl. padding
            var yoffset = 5 + ((1 + lineno) * (fontSize * 1.1));
            ctx.fillText(line, center, yoffset, width - 10);
            ctx.strokeText(line, center, yoffset, width - 10);
        });
        bottom.split("\n").reverse().map(function (line, lineno) {
            var yoffset = height - 10 - (lineno * (fontSize * 1.1));
            ctx.fillText(line, center, yoffset, width - 10);
            ctx.strokeText(line, center, yoffset, width - 10);
        });
    }

    document.getElementById("dl-btn").addEventListener("click", function (e) {
        e.target.href = canvas.toDataURL("image/jpg");
    });

    var canvas = document.getElementById("canvas");
    canvas.setAttribute("height", height);
    canvas.setAttribute("width", width);
    var ctx = canvas.getContext('2d');
    ctx.fillStyle = "#FFF";
    ctx.strokeStyle = "#000";
    ctx.textAlign = "center";
    img.src = "meme.jpg";
    img.width=width;
    img.addEventListener("load", function (e) {
        mock();
    });

</script>
</body>
</html>